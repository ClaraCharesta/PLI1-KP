<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title><%= mode==='edit' ? 'Edit Laporan Shift RMFM5' : 'Tambah Laporan Shift RMFM5' %></title>
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/topbar.css">
  <link rel="stylesheet" href="/css/laporanShiftRMFM5.css">
</head>
<body>

<form id="rmfm5Form">

<%- include('partials/sidebar', { active: 'laporan' }) %>

<div class="main">
  <%- include('partials/topbar', { title: mode==='edit' ? 'Edit Laporan Shift RMFM5' : 'Tambah Laporan Shift RMFM5' }) %>

  <div class="content">
    <div class="form-card">

      <!-- TOP INFO -->
      <div class="form-grid top-info">
        <div class="form-group">
          <label>Tanggal</label>
          <input type="date" id="tanggal" name="tanggal" value="<%= formData?.tanggal || '' %>" required>
        </div>
        <div class="form-group">
          <label>Shift Utama</label>
          <select id="shiftUtama" name="shift_kode" required>
            <option value="">-- pilih --</option>
            <% shifts.forEach(s=>{ %>
              <option value="<%= s %>" <%= formData?.shift_kode===s?'selected':'' %>><%= s %></option>
            <% }) %>
          </select>
        </div>
        <!-- NO REF -->
        <div class="form-group">
          <label>No. Ref</label>
          <input 
            type="text" 
            id="noref" 
            name="no_ref"
            value="<%= formData?.no_ref || '' %>"  
            readonly>
        </div>
        <div class="form-group">
          <label>Dibuat Oleh</label>
          <input type="text" value="<%= user?.email || user?.nama || '' %>" readonly>
        </div>
      </div>

      <!-- PERSONIL -->
      <% ['851a','851b','852a','852b'].forEach(p => { %>
        <div class="form-grid">
          <div class="form-group">
            <label>Personil (<%= p %>)</label>
            <select class="personil" name="personil_<%= p %>" data-key="<%= p %>"></select>
          </div>
          <div class="form-group">
            <label>Shift (<%= p %>)</label>
            <select class="shift" name="shift_<%= p %>" data-key="<%= p %>"></select>
          </div>
        </div>
      <% }) %>

      <!-- CUTI -->
      <div class="form-group">
        <label>Personil Cuti</label>
        <div class="cuti-box" id="cutiBox"></div>
        <input type="hidden" id="cutiResult" name="cuti" value="<%= formData?.cuti || '' %>">
      </div>

      <!-- ID hidden for edit -->
      <% if(mode==='edit'){ %>
        <input type="hidden" id="id" name="id" value="<%= formData.id %>">
      <% } %>

      <!-- BUTTONS -->
      <div class="btn-wrapper">
        <button class="back" type="button">Back</button>
        <button class="clear" type="button">Clear</button>
        <button class="save" type="button">Save</button>
      </div>

    </div>
  </div>

</div>
</form>

<script>
window.formData = <%- JSON.stringify(formData || {}) %>;
</script>
<script src="/js/formShiftRMFM5.js"></script>
<script src="/js/sidebar.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelector(".back").onclick = () => window.location.href = "/laporan-shift/rmfm5";
  document.querySelector(".clear").onclick = () => document.querySelector("form").reset();
});
</script>
</body>
</html>