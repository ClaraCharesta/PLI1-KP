<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Abnormalitas</title>

  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/topbar.css">
  <link rel="stylesheet" href="/css/dataAbnormalitas.css">
</head>
<body>

  <%- include('partials/sidebar') %>

  <div class="main">
    <%- include('partials/topbar', { title: "Data Abnormalitas", showBackButton: true }) %>

    <div class="content">
      <!-- HEADER -->
      <div class="header-box">
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="">
          <button id="btnSearch" type="button">Search</button>
        </div>
        <button id="btnAdd" class="btn-add" data-target="formDataAbnormalitas">+ Add</button>
      </div>

      <!-- TABLE WRAPPER FOR HORIZONTAL SCROLL -->
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>No</th>
              <th>Status</th>
              <th>Week Number</th>
              <th>Abnormal Date</th>
              <th>Report By</th>
              <th>Area</th>
              <th>Nomenclature</th>
              <th>Activity</th>
              <th>Prioritas</th>
              <th>Condition</th>
              <th>Action</th>
              <th>Abnormal</th>
              <th>Source</th>
              <th>Informasi Detail</th>
              <th>Rencana Perbaikan</th>
              <th>Notifikasi ke Unit Lain</th>
              <th>ID MSO</th>
              <th>Foto Sebelum</th>
              <th>Foto Sesudah</th>
              <th>Created By</th>
              <th>Aksi</th>
            </tr>
          </thead>

          <!-- üî¥ WAJIB ADA -->
          <tbody>
            <% if (typeof data !== "undefined" && data.length > 0) { %>
              <% data.forEach((item, index) => { %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td><%= item.status %></td>
                  <td><%= item.week_number %></td>
                  <td><%= item.abnormal_date %></td>
                  <td><%= item.report_by %></td>
                  <td><%= item.area %></td>
                  <td><%= item.nomenclature %></td>
                  <td><%= item.activity %></td>
                  <td><%= item.prioritas %></td>
                  <td><%= item.condition %></td>
                  <td><%= item.action %></td>
                  <td><%= item.abnormal %></td>
                  <td><%= item.source %></td>
                  <td><%= item.detail_info %></td>
                  <td><%= item.rencana_perbaikan %></td>
                  <td><%= item.notifikasi_unit %></td>
                  <td><%= item.id_mso %></td>

                  <td>
                    <% if (item.foto_sebelum) { %>
                      <img src="/uploads/<%= item.foto_sebelum %>" class="img-thumb">
                    <% } else { %>
                      -
                    <% } %>
                  </td>

                  <td>
                    <% if (item.foto_sesudah) { %>
                      <img src="/uploads/<%= item.foto_sesudah %>" class="img-thumb">
                    <% } else { %>
                      -
                    <% } %>
                  </td>

                  <td>
                    <%= item.creator ? item.creator.nama : '-' %>
                  </td>

                  <td class="aksi">
                    <button class="edit" data-id="<%= item.abnormal_id %>">Edit</button>
                    <button class="delete" data-id="<%= item.abnormal_id %>">Hapus</button>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <!-- KONDISI DATA KOSONG -->
              <tr>
                <td colspan="21" style="text-align:center; padding:20px;">
                  Belum ada data abnormalitas
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <!-- ================= DELETE MODAL ================= -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-icon">üóëÔ∏è</div>
      <h2>Delete Data</h2>
      <p>Apakah anda yakin ingin menghapus?</p>
      <div class="modal-buttons">
        <button id="deleteBtn" class="btn-delete">Delete</button>
        <button id="keepBtn" class="btn-keep">Keep</button>
      </div>
    </div>
  </div>

  <script src="/js/dataAbnormalitas.js"></script>

</body>
</html>
