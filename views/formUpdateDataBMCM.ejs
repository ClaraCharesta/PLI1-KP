<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Update Realisasi PK Harian</title>

  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/topbar.css">
  <link rel="stylesheet" href="/css/formDataBMCM.css">

</head>
<body>

<%- include('partials/sidebar') %>

<div class="main">

  <%- include('partials/topbar', { title: "Update Realisasi PK Harian" }) %>

  <div class="content">
    <div class="form-card">
      <h2>Update Realisasi PK Harian</h2>

      <form
        id="formDataBMCM"
        action="/dataBMCM/update/<%= data.pk_id %>"
        method="POST"
        enctype="multipart/form-data"
      >

        <!-- TANGGAL -->

        <div class="form-group">
          <label for="tanggal">Tanggal</label>
          <input type="date" id="tanggal" name="tanggal" value="<%= tanggalFormatted %>" required>
        </div>

        <!-- AREA -->

        <div class="form-group">
          <label for="area">Area</label>
          <select name="area" id="area" style="width:100%" required>
            <option value="">-- Pilih Area --</option>
              <option value="RM5">RM5</option>
              <option value="KCM5">KCM5</option>
              <option value="AUTO5">AUTO5</option>
              <option value="FM5">FM5</option>
              <option value="Shift KCM 5">Shift KCM 5</option>
              <option value="Shift RMFM 5">Shift RMFM 5</option>
          </select>
        </div>

        <!-- SUPERVISOR -->

        <div class="form-group">
          <label for="supervisor">Supervisor</label>
          <select id="supervisor" name="supervisor" required>
            <option value="">-- Pilih Supervisor --</option>

            <% [
              "DASKI WANDI","ZULFAHMI AMRI","AFRIZAL","DERY SUWANDI",
              "KHAIRIAL AZHAR, ST.","ALBANI","HENGKI SURYADI","SARDINAL"
            ].forEach(s => { %>

              <option value="<%= s %>" <%= data.supervisor===s?"selected":"" %>><%= s %></option>
            <% }) %>

          </select>
        </div>

        <!-- EXECUTOR -->

        <div class="form-group">
          <label for="executor">Executor</label>
          <select id="executor" name="executor" required>
            <option value="">-- Pilih Executor --</option>

            <% [
              "Fill Ardi","Rivaldi","Lisofrizal","Suryadi","Boni Syaputra",
              "Rizky Putra","Ilham Maulana","Rully Chandra","Darmansyah",
              "Dede Andika Putra","Haryudi","Hendra","Jhoni Sadirman",
              "Arif Kurnia Martin","Muhammad Khairul Warman","Sandi Putra",
              "Ilham Juhendra","Ego Geovani Yanitra","Rahmad Ardianto",
              "Candra Purnomo","Wahyu Ikhsan","Salman","Meri Fernandes",
              "Riki Sulaiman","Astorio Prima","Afrizal","Jumaidi Bakri",
              "Nofriza Juanda","Angga Wahyudi","Syafril","Randi Pratama",
              "Wily Surya Dinata"
            ].forEach(e => { %>

              <option value="<%= e %>" <%= data.executor===e?"selected":"" %>><%= e %></option>
            <% }) %>

          </select>
        </div>

        <!-- CATEGORY -->

        <div class="form-group">
          <label for="activitiesCategory">Activities Category</label>
          <select id="activitiesCategory" name="activitiesCategory" required>
            <option value="">-- Pilih Kategori --</option>
            <option value="BM (Basic Maintenance)"
              <%= data.activity_category?.startsWith("BM")?"selected":"" %>>
              BM (Basic Maintenance)
            </option>

            <option value="CM (Corective Maintenance)"
              <%= data.activity_category?.startsWith("CM")?"selected":"" %>>
              CM (Corective Maintenance)
            </option>
          </select>
        </div>

        <!-- DETAIL -->

        <div class="form-group">
          <label for="detailActivities">Detail Activities</label>
          <input
            type="text"
            id="detailActivities"
            name="detailActivities"
            value="<%= data.detail_activities %>"
          >
        </div>

        <!-- COUNTER -->

        <% const counter = (id, label, val, maxLimit=null) => { %>
        <div class="form-group">
          <label for="<%= id %>"><%= label %></label>
        <div class="input-counter">
          <button type="button" class="btn-counter" data-action="minus">‚àí</button>
        <input 
         type="number" 
         id="<%= id %>" 
         name="<%= id %>" 
         value="<%= val %>"  
         <%= maxLimit !== null ? `max="${maxLimit}"` : "" %>
        >
        <button type="button" class="btn-counter" data-action="plus">+</button>
        </div>
        </div>
        <% } %>

        <% counter("duration", "Duration (Jam)", data.duration); %>
        <% counter("jumlahPersonel", "Jumlah Personel", data.jumlah_personil); %>
        <% counter("statusPersen", "Status %", data.status_persen, 100); %>

        <!-- STATUS -->

        <div class="form-group">

          <label for="status">Status</label>
          <select id="status" name="status" required>
            <option value="">-- Pilih Status --</option>
            <option value="Open" <%= data.status==="Open"?"selected":"" %>>Open</option>
            <option value="In Progress" <%= data.status==="In Progress"?"selected":"" %>>In Progress</option>
            <option value="Close" <%= data.status==="Close"?"selected":"" %>>Close</option>
          </select>

        </div>

        <!-- KETERANGAN -->

        <div class="form-group">
          <label for="keterangan">Keterangan</label>
          <textarea id="keterangan" name="keterangan"><%= data.keterangan %></textarea>
        </div>

        <!-- UPLOAD -->

        <div class="upload-section">
          <div class="upload-grid">
            <div class="upload-box">
              <input type="file" id="fotoSafetyTalk" name="fotoSafetyTalk" accept="image/*" hidden>
              <label for="fotoSafetyTalk" class="upload-label">
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∏</span>
                  <span class="upload-text">Upload Foto Safety Talk</span>
                </div>
                <div class="upload-preview">
                  <% if (data.foto_safety_talk) { %>
                    <img src="/uploads/<%= data.foto_safety_talk %>">
                  <% } %>
                </div>
              </label>
            </div>

            <div class="upload-box">
              <input type="file" id="fotoCheckSheet" name="fotoCheckSheet" accept="image/*" hidden>
              <label for="fotoCheckSheet" class="upload-label">
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∏</span>
                  <span class="upload-text">Upload Foto Check Sheet</span>
                </div>
                <div class="upload-preview">
                  <% if (data.foto_check_sheet) { %>
                    <img src="/uploads/<%= data.foto_check_sheet %>">
                  <% } %>
                </div>
              </label>
            </div>
          </div>
        </div>


        <!-- BUTTON -->

        <div class="btn-wrapper"> 
          <button type="button" class="btn-cancel">Cancel</button>
          <button type="submit" class="btn-save btn-update">Update</button>
        </div>

      </form>
    </div>
  </div>
</div>

  <!-- ================= CANCEL MODAL ================= -->
  <div id="cancelModal" class="modal">
    <div class="modal-content">
      <div class="modal-icon">‚ö†Ô∏è</div>
      <h2>Batalkan Perubahan</h2>
      <p>Apakah anda yakin ingin membatalkan perubahan?</p>
      <div class="modal-buttons">
        <button id="confirmCancelBtn" class="btn-confirm">Ya, Batalkan</button>
        <button id="keepCancelBtn" class="btn-keep">Tidak</button>
      </div>
    </div>
  </div>

<script src="/js/formUpdateDataBMCM.js"></script>
</body>

</html>